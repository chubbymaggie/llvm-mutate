<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>llvm-mutate &#x2013; mutate LLVM IR</title>
<!-- 2013-04-30 Tue 07:13 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="generator" content="Org-mode"/>
<meta name="author" content="Eric Schulte"/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<style>pre{background:#232323; color:#E6E1DC;} @media(min-width:800px){div#content{max-width:800px; padding:2em; margin:auto;}}</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">llvm-mutate &#x2013; mutate LLVM IR</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#introduction">1. Introduction</a></li>
<li><a href="#instillation">2. Installation</a></li>
<li><a href="#examples">3. Examples</a></li>
<li><a href="#license">4. License</a></li>
</ul>
</div>
</div>

<div id="outline-container-introduction" class="outline-2">
<h2 id="introduction"><a id="sec-1" name="sec-1"></a><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-introduction">
<p>
LLVM Mutate is an LLVM compilers pass <small>[<a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a>]</small>.  Like all compiler
passes, it manipulates LLVM intermediate representation (IR), but
unlike most compiler passes it explicitly does <b>not</b> preserve
semantics.  Instead it provides a number of simple mutation operations
which may be specified through command line flags.  These operations
are more similar to genetic programming <small>[<a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a>]</small> or mutation
testing <small>[<a id="fnr.3" name="fnr.3" class="footref" href="#fn.3">3</a>]</small> operations than they are to traditional compiler
transformations.
</p>

<p>
Mutation Operations
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="left"/>

<col class="left"/>
</colgroup>
<tbody>
<tr>
<td class="left">ids</td>
<td class="left">prints the total number of instructions</td>
</tr>

<tr>
<td class="left">list</td>
<td class="left">lists each instruction with its type and its assigned id</td>
</tr>

<tr>
<td class="left">name</td>
<td class="left">names each instruction (using LLVM's <a href="http://llvm.org/docs/doxygen/html/classllvm_1_1Value.html#a35ee267850af7c235474a8c46c7ac5af">Value.setName</a>)</td>
</tr>

<tr>
<td class="left">trace</td>
<td class="left">instrument to trace all executed instructions</td>
</tr>

<tr>
<td class="left">cut</td>
<td class="left">removes the numbered instruction from the program</td>
</tr>

<tr>
<td class="left">insert</td>
<td class="left">copies the second numbered instruction before the first</td>
</tr>

<tr>
<td class="left">replace</td>
<td class="left">replace the first numbered instruction with the second</td>
</tr>

<tr>
<td class="left">swap</td>
<td class="left">swaps the two numbered instructions</td>
</tr>
</tbody>
</table>

<p>
The <code>llvm-mutate</code> shell script wraps this compiler pass in a simple
interface which facilitates program manipulation.  See the <a href="#examples">examples</a>
and the help output <small>[<a id="fnr.4" name="fnr.4" class="footref" href="#fn.4">4</a>]</small>
</p>

<p>
To support application of these simple operations some surgery must be
performed on the data dependency graph to both (1) replace the use of
removed instructions, and to (2) fully incorporate added instructions.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="left"/>

<col class="left"/>
</colgroup>
<tbody>
<tr>
<td class="left">1. Removed instruction.</td>
<td class="left">2. Added instruction.</td>
</tr>

<tr>
<td class="left"><img src="removed-instruction.png"  alt="removed-instruction.png"/></td>
<td class="left"><img src="added-instruction.png"  alt="added-instruction.png"/></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-instillation" class="outline-2">
<h2 id="instillation"><a id="sec-2" name="sec-2"></a><span class="section-number-2">2</span> Installation</h2>
<div class="outline-text-2" id="text-instillation">

<ol class="org-ol">
<li>Copy or clone this repository <small>[<a id="fnr.5" name="fnr.5" class="footref" href="#fn.5">5</a>]</small> to <code>llvm/lib/Transforms/Mutate</code> in
your LLVM source tree,
</li>

<li>Run <code>make</code> from within the Mutate directory.  See <small>[<a id="fnr.1.100" name="fnr.1.100" class="footref" href="#fn.1">1</a>]</small> for more
information on building LLVM compiler passes.
</li>

<li>Place the <code>llvm-mutate</code> script in your path.  It may be necessary
to set the <code>LLVM</code> environment variable to the base of your LLVM
install so that the <code>llvm-mutate</code> script can load the <code>Mutate.so</code>
shared library (Note: if you re-install LLVM after adding this
repository to the Transforms directory setting the <code>LLVM</code>
environment variable should not be necessary).
</li>
</ol>
</div>
</div>
<div id="outline-container-examples" class="outline-2">
<h2 id="examples"><a id="sec-3" name="sec-3"></a><span class="section-number-2">3</span> Examples</h2>
<div class="outline-text-2" id="text-examples">

<p>Examples</p>

<p>First compile a source file to LLVM assembly.</p>

<pre><code> $ echo 'main(){ puts("hello"); puts("goodbye");}' \
     |clang -x c - -S -emit-llvm -o greet.ll
</code></pre>

<p>See the behavior of the original.</p>

<pre><code> $ cat greet.ll|./llvm-mutate -l

 $ ./a.out
 hello
 goodbye
</code></pre>

<p>Count the instruction ids in the original program.</p>

<pre><code> $ cat greet.ll|./llvm-mutate -I -o /dev/null
 3
</code></pre>

<p>Compile a version which saves an instruction execution trace</p>

<pre><code> $ cat greet.ll|llvm-mutate -t -l
 $ ./a.out 
 hello
 goodbye
 $ cat llvm_mutate_trace
 1
 2
 3
</code></pre>

<p>Cut the first instruction from this program, compile and run.</p>

<pre><code> $ cat greet.ll|./llvm-mutate -c 1 -l
 cut 1

 $ ./a.out
 goodbye
</code></pre>

<p>Insert the second instruction before the first.</p>

<pre><code> $ cat greet.ll|./llvm-mutate -i 1,2 -l
 inserted 2 before 1

 $ ./a.out
 goodbye
 hello
 goodbye
</code></pre>

<p>Swap the first two instructions.</p>

<pre><code> $ cat greet.ll|./llvm-mutate -s 1,2 -l
 swapped 1 with 2

 $ ./a.out
 goodbye
 hello
</code></pre>

<p>We can also look at a slightly more complicated file which actually
   has some data dependencies between instructions.  Dependencies which
   the mutation tool will need to address.</p>

<pre><code> $ make arith.ll

 $ cat arith.ll|./llvm-mutate -l

 $ ./a.out
 25
</code></pre>

<p>Here mutations will change the data dependencies between the
   instructions, and effect the value of <code>x</code> which is printed at the
   end.</p>

<pre><code> $ cat arith.ll|./llvm-mutate -c 4 -l
 found local replacement: 0x2ac0aa8
 cut 4

 $ ./a.out
 4

 $ cat arith.ll|./llvm-mutate -c 3 -l
 cut 3

 $ ./a.out
 9

 $ cat arith.ll|./llvm-mutate -c 6 -l
 found local replacement: 0x39aaaa8
 cut 6

 $ ./a.out
 10
</code></pre>

<p>The compiler pass attempts to plug new instructions into the call
   graph near where they are inserted, satisfying their arguments with
   in-scope variables and plugging their output into the arguments of
   subsequent variables.</p>

<pre><code> $ cat arith.ll|./llvm-mutate -i 6,9 -l
 replacing argument: 0x2f6ce50
 found local replacement: 0x2f6cae8
 inserted 9 before 6

 $ ./a.out
 4
</code></pre>

<p>When this isn't possible, a warning is printed and the insertion
   likely has no effect.</p>

<pre><code> $ cat arith.ll|./llvm-mutate -i 4,10 -l
 could find no use for result
 inserted 10 before 4

 $ ./a.out
 25
</code></pre>

<p>Unless of course the inserted instruction acts through side effects.
   For example this copies the printf instruction into the middle of
   the function.</p>

<pre><code> $ cat arith.ll|./llvm-mutate -i 4,11 -l
 replacing argument: 0x1e34f88
 found local replacement: 0x1e34ae8
 inserted 11 before 4

 $ ./a.out
 2
 25
</code></pre>

<p>See the output of <code>llvm-mutate --help</code> for more actions which may
   be performed on compiled llvm IR.  If multiple options are given to
   llvm-mutate they will be applied in series to the code.  So for
   example the following command line will,</p>

<pre><code> $ cat arith.ll|./llvm-mutate -I -g -G -c 3 -I -i 4,10 -I -G -l
 12
 cut 3
 11
 replacing argument: 0x1d7df08
 found local replacement: 0x1d7db80
 inserted 10 before 4
 12

 $ ./a.out 
 3
 9
</code></pre>

<ol>
<li>print a count of instruction ids,</li>
<li>generate the program control flow graph
  (shown on screen if <code>dot</code> and <code>feh</code> are installed),</li>
<li>generate the program call graph</li>
<li>cut an instruction,</li>
<li>print another id count,</li>
<li>inserts an instruction,</li>
<li>prints a third instruction id count,</li>
<li>display the new call graph</li>
<li>and finally link the resulting LLVM IR into an executable.</li>
</ol>
</div>
</div>
<div id="outline-container-license" class="outline-2">
<h2 id="license"><a id="sec-4" name="sec-4"></a><span class="section-number-2">4</span> License</h2>
<div class="outline-text-2" id="text-license">

<p>
Licensed under the GPLV3, see the <a href="COPYING">COPYING</a> file in this directory
for more information.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><small>[<a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a>]</small> <p class="footpara">
<a href="http://llvm.org/docs/WritingAnLLVMPass.html">http://llvm.org/docs/WritingAnLLVMPass.html</a>
</p></div>

<div class="footdef"><small>[<a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a>]</small> <p class="footpara">
<a href="http://www.gp-field-guide.org.uk/">http://www.gp-field-guide.org.uk/</a>
</p></div>

<div class="footdef"><small>[<a id="fn.3" name="fn.3" class="footnum" href="#fnr.3">3</a>]</small> <p class="footpara">
<a href="http://scholar.google.com/scholar?as_q=&as_epq=An+analysis+and+survey+of+the+development+of+mutation+testing&as_oq=&as_eq=&as_occt=any&as_sauthors=Jia&as_publication=ieee&as_ylo=2011&as_yhi=2011&btnG=&hl=en&as_sdt=0,32">An analysis and survey of the development of mutation testing</a>
</p></div>

<div class="footdef"><small>[<a id="fn.4" name="fn.4" class="footnum" href="#fnr.4">4</a>]</small> <p class="footpara">
Help information for the <code>llvm-mutate</code> script.
</p>
<div class="org-src-container">

<pre class="src src-sh">llvm-mutate --help
</pre>
</div>

<pre class="example">
llvm-mutate -[n|l|g|G] -[c|i|s instructions] -l -[o path]
 mutate llvm IR

Options
 -I,--ids -------- print the number of instructions
 -L,--list ------- list instructions with number and types
 -n,--name ------- name each instruction w/number
 -g,--cfg -------- graph the CFG
 -G,--call-graph - graph the call graph
 -c,--cut -------- cut the given instruction
 -r,--replace ---- replace the first inst. with the second
 -i,--insert ----- copy the second inst. before the first
 -s,--swap ------- swap the given instructions
 -l,--link ------- link the result into an executable
 -o,--out -------- write output to specified file
</pre></div>

<div class="footdef"><small>[<a id="fn.5" name="fn.5" class="footnum" href="#fnr.5">5</a>]</small> <p class="footpara">
<a href="https://github.com/eschulte/llvm-mutate">https://github.com/eschulte/llvm-mutate</a>
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Eric Schulte</p>
<p class="date">Created: 2013-04-30 Tue 07:13</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.0-pre)</p>
<p class="xhtml-validation"><a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a></p>
</div>
</body>
</html>
